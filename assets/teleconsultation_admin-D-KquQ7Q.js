import{q as d,w as c,c as r,d as i,a as u,o as f,f as l,i as g,l as y,k as S,g as m,h as p}from"./index-B0XDuo0H.js";function b(e){const t=d(r(i,"teleconsultations"),c("status","==","open"),c("responder_id","==",null));return u(t,s=>{const o=s.docs.map(n=>({id:n.id,...n.data()}));e(o)})}function h(e,t){const s=d(r(i,"teleconsultations"),c("responder_id","==",e),c("status","==","active"));return u(s,o=>{const n=o.docs.map(a=>({id:a.id,...a.data()}));t(n)})}function q(e,t){const s=d(r(i,"teleconsultations",e,"messages"),f("timestamp","asc"));return u(s,o=>{const n=o.docs.map(a=>({id:a.id,...a.data()}));t(n)})}function D(e,t){const s=l(i,"teleconsultations",e);return u(s,n=>{if(n.exists()){const a=n.data();t(a.status??null)}else t(null)})}async function R(e,t){const s=r(i,"teleconsultations",e,"messages");await m(s,{sender:"doctor",text:t,timestamp:p()})}async function _(e,t){try{const s=l(i,"teleconsultations",e);await y(s,{responder_id:t,status:"active"});const n=(await S(s)).data();if(!n?.userId)return;const a=r(i,"notifications");await m(a,{to:n.userId,message:`Your ${n.type||"session"} has been claimed by an admin.`,appointmentId:e,read:!1,createdAt:p()}),console.log("Session claimed and user notified successfully.")}catch(s){throw console.error("Error claiming session:",s),s}}async function v(e){const t=d(r(i,"teleconsultations"),c("status","==","closed"),c("responder_id","==",e)),s=await g(t);return s.empty?[]:s.docs.map(o=>({id:o.id,...o.data()}))}export{h as a,q as b,_ as c,D as d,v as g,b as l,R as s};
