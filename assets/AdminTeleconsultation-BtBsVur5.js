import{f as k,d as F,k as U,r as a,j as s,L as b}from"./index-B0XDuo0H.js";import{l as T,a as _,g as M,c as D}from"./teleconsultation_admin-D-KquQ7Q.js";async function E(n){const c=k(F,"users",n),d=await U(c);return d.exists()?d.data():null}function R({userId:n}){const[c,d]=a.useState([]),[y,S]=a.useState([]),[j,w]=a.useState([]),[t,h]=a.useState(null),[i,f]=a.useState(!1);async function x(e){return await Promise.all(e.map(async r=>{const m=r.user_id||r.userId,u=m?await E(m):null;return{...r,user:u}}))}a.useEffect(()=>{const e=new Date,N=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0"),u=`${N}${r}${m}`,$=T(async l=>{const o=l.filter(p=>String(p.id).startsWith(u)),g=await x(o);d(g)}),A=_(n,async l=>{const o=l.filter(p=>String(p.id).startsWith(u)),g=await x(o);S(g)});return(async()=>{const l=await M(n),o=await x(l);w(o)})(),()=>{$?.(),A?.()}},[n]);const C=e=>{h(e)},v=async()=>{if(t){f(!0);try{await D(t.id,n),h(null)}catch(e){console.error("Failed to claim session:",e),alert("Failed to claim session. It may have already been claimed.")}finally{f(!1)}}};return s.jsxs("div",{className:"p-6",children:[s.jsx("h1",{className:"text-xl font-semibold text-[#0F8A69] mb-6",children:"Admin â€“ Teleconsultations"}),s.jsx("h2",{className:"text-lg font-medium mb-3",children:"Unassigned Sessions"}),s.jsxs("div",{className:"space-y-3",children:[c.length===0&&s.jsx("p",{className:"text-gray-500",children:"No unassigned sessions."}),c.map(e=>s.jsxs("div",{className:"border p-4 rounded-lg",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"User:"})," ",e.user?`${e.user.firstName} ${e.user.lastName}`:e.user_id]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Type:"})," ",e.type||"N/A"]}),s.jsx("button",{onClick:()=>C(e),className:"mt-3 py-2 px-4 rounded-lg text-white bg-[#0F8A69] hover:bg-[#0c7356]",children:"Claim Session"})]},e.id))]}),s.jsx("h2",{className:"text-lg font-medium mt-8 mb-3",children:"My Active Sessions"}),s.jsxs("div",{className:"space-y-3",children:[y.length===0&&s.jsx("p",{className:"text-gray-500",children:"You don't have active sessions."}),y.map(e=>s.jsxs("div",{className:"border p-4 rounded-lg",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"User:"})," ",e.user?`${e.user.firstName} ${e.user.lastName}`:e.user_id]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Type:"})," ",e.type||"N/A"]}),s.jsx(b,{to:`/admin-chat/${e.id}`,className:"mt-3 block bg-blue-600 text-white py-2 px-4 rounded-lg text-center",children:"Open Chat"})]},e.id))]}),s.jsx("h2",{className:"text-lg font-medium mt-8 mb-3",children:"Closed Sessions (History)"}),s.jsxs("div",{className:"space-y-3",children:[j.length===0&&s.jsx("p",{className:"text-gray-500",children:"No closed sessions yet."}),j.map(e=>s.jsxs("div",{className:"border p-4 rounded-lg",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"User:"})," ",e.user?`${e.user.firstName} ${e.user.lastName}`:e.user_id]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Type:"})," ",e.type||"N/A"]}),s.jsx(b,{to:`/admin-chat/${e.id}`,className:"mt-3 block bg-gray-600 text-white py-2 px-4 rounded-lg text-center",children:"View Chat"})]},e.id))]}),t&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-96",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Confirm Claim"}),s.jsxs("p",{className:"mb-6 text-gray-700",children:["Are you sure you want to claim the session for"," ",s.jsx("strong",{children:t.user?`${t.user.firstName} ${t.user.lastName}`:t.user_id}),"?"]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{onClick:()=>!i&&h(null),className:`px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 ${i?"cursor-not-allowed opacity-50":""}`,children:"Cancel"}),s.jsx("button",{onClick:v,className:`px-4 py-2 rounded-lg bg-[#0F8A69] text-white hover:bg-[#0c7356] ${i?"cursor-not-allowed opacity-50":""}`,disabled:i,children:i?"Claiming...":"Confirm"})]})]})})]})}export{R as default};
