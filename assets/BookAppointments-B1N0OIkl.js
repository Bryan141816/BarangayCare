import{r as n,A as T,q as I,o as P,c as _,a as D,j as e,d as R}from"./index-Da8wnO7y.js";import{c as k}from"./appointmentservices-CZzoJrDK.js";const s={GENERAL_CHECKUP:"general-checkup",VACCINATION:"vaccination",PRENATAL:"prenatal",CHILD_HEALTH:"child-health",NUTRITION:"nutrition",BP_CHECK:"bp-check",FAMILY_PLANNING:"family-planning",DENTAL:"dental",SENIOR_WELLNESS:"senior-wellness",WOUND_CARE:"wound-care"},j={[s.GENERAL_CHECKUP]:"General Check-up",[s.VACCINATION]:"Vaccination",[s.PRENATAL]:"Prenatal Check-up",[s.CHILD_HEALTH]:"Child Health Consultation",[s.NUTRITION]:"Nutrition Assessment",[s.BP_CHECK]:"Blood Pressure Check",[s.FAMILY_PLANNING]:"Family Planning",[s.DENTAL]:"Dental Check-up",[s.SENIOR_WELLNESS]:"Senior Citizen Wellness",[s.WOUND_CARE]:"Wound Care / Dressing"};function O(){const{currentUser:l}=n.useContext(T),[u,m]=n.useState(""),[p,h]=n.useState(""),[x,g]=n.useState(""),[f,c]=n.useState(""),[N,b]=n.useState(""),[a,C]=n.useState(null),[i,A]=n.useState(!1),[y,d]=n.useState(!1),S=async()=>{c(""),b(""),A(!0);const t={serviceType:u,preferredDateTime:p,purpose:x,requestedBy:l?.uid||"unknown-user"};try{const o=await k(t);o.success?(b("Appointment request submitted successfully!"),m(""),h(""),g("")):c(o.error||"Failed to create appointment.")}catch{c("An error occurred while submitting the appointment.")}finally{A(!1),d(!1)}};return n.useEffect(()=>{const t=I(_(R,"appointments"),P("createdAt","desc")),o=D(t,E=>{const v=E.docs.map(r=>{const w=r.data(),{id:H,...L}=w;return{id:r.id,...L}}).filter(r=>r.status!=="completed"&&r.status!=="rejected"&&r.status!=="failed"&&r.requestedBy===l?.uid);C(v[0]||null)});return()=>o()},[l]),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-[#0F8A69] mb-6",children:"Book Appointment"}),a?e.jsxs("div",{className:"bg-white shadow-md rounded-2xl p-6 border border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-[#0F8A69] mb-3",children:"Your Latest Appointment"}),e.jsxs("div",{className:"space-y-2 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Service:"})," ",j[a.serviceType]]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Preferred Date & Time:"})," ",new Date(a.preferredDateTime).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Purpose:"})," ",a.purpose]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",e.jsx("span",{className:`font-bold ${a.status==="waiting for approval"?"text-yellow-600":"text-green-600"}`,children:a.status})]})]})]}):e.jsxs(e.Fragment,{children:[f&&e.jsx("p",{className:"text-red-600 font-medium mb-3",children:f}),N&&e.jsx("p",{className:"text-green-600 font-medium mb-3",children:N}),e.jsx("div",{className:"bg-white shadow-md rounded-2xl p-8",children:e.jsxs("form",{className:"space-y-5",onSubmit:t=>{t.preventDefault(),d(!0)},children:[e.jsxs("select",{className:"w-full border rounded-lg p-3 outline-none focus:ring-2 focus:ring-[#0F8A69] bg-white",value:u,onChange:t=>m(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Service Type"}),Object.values(s).map(t=>e.jsx("option",{value:t,children:j[t]},t))]}),e.jsx("input",{type:"datetime-local",className:"w-full border rounded-lg p-3 outline-none focus:ring-2 focus:ring-[#0F8A69]",value:p,onChange:t=>h(t.target.value),required:!0}),e.jsx("textarea",{rows:5,placeholder:"Purpose / Reason",className:"w-full border rounded-lg p-3 outline-none focus:ring-2 focus:ring-[#0F8A69] resize-none",value:x,onChange:t=>g(t.target.value),required:!0}),e.jsx("button",{type:"submit",disabled:i,className:`w-full bg-[#0F8A69] hover:bg-[#0c7356] text-white py-3 rounded-lg font-medium transition ${i?"opacity-50 cursor-not-allowed":""}`,children:i?"Submitting...":"Submit"})]})})]}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-96",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Confirm Appointment"}),e.jsx("p",{className:"mb-6 text-gray-700",children:"Are you sure you want to create this appointment?"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition",children:"Cancel"}),e.jsx("button",{onClick:S,className:"px-4 py-2 rounded-lg bg-[#0F8A69] text-white hover:bg-[#0c7356] transition",children:i?"Submitting...":"Confirm"})]})]})})]})}export{O as default};
