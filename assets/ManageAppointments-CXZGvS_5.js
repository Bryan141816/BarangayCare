import{r as o,q as L,o as P,c as E,a as $,j as e,d as z}from"./index-BzMBnkf4.js";import{u as m}from"./appointmentservices-BKw33aDV.js";import{F as D}from"./CalendarDaysIcon-0fN9HM-M.js";import{F as O}from"./MapPinIcon-B7sHTctG.js";function U(){const[g,A]=o.useState([]),[f,C]=o.useState("all"),[F,j]=o.useState(!1),[s,b]=o.useState(null),[x,d]=o.useState(""),[i,c]=o.useState(""),[a,h]=o.useState(""),[R,p]=o.useState(!1),[r,l]=o.useState(!1),v={"waiting for approval":1,approved:2,rejected:3,completed:4,failed:5};o.useEffect(()=>{const t=L(E(z,"appointments"),P("createdAt","desc")),n=$(t,M=>{const y=M.docs.map(u=>({id:u.id,...u.data()}));y.sort((u,q)=>v[u.status]-v[q.status]),A(y)});return()=>n()},[]);const S=f==="all"?g:g.filter(t=>t.status===f),w=t=>{b(t),d(t.location||""),c(t.rejectionReason||""),h(""),j(!0)},N=()=>{b(null),d(""),c(""),h(""),j(!1),p(!1),l(!1)},k=async()=>{if(!(!s||!a)){l(!0);try{if(a==="approve"){if(!x.trim()){alert("Location is required for approval."),l(!1);return}await m(s.id,{status:"approved",location:x})}else if(a==="reject"){if(!i.trim()){alert("Reason is required for rejection."),l(!1);return}await m(s.id,{status:"rejected",rejectionReason:i})}else if(a==="complete")await m(s.id,{status:"completed"});else if(a==="fail"){if(!i.trim()){alert("Reason is required for failing."),l(!1);return}await m(s.id,{status:"failed",rejectionReason:i})}}catch(t){console.error(t),alert("An error occurred while updating appointment.")}finally{l(!1),p(!1),N()}}};return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-[#0F8A69] mb-6",children:"Manage Appointments"}),e.jsxs("select",{className:"border p-2 rounded-lg mb-4",value:f,onChange:t=>C(t.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"waiting for approval",children:"Waiting for Approval"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsx("div",{className:"grid gap-4",children:S.map(t=>e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow border border-gray-200",children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg mb-2",children:t.serviceType}),e.jsxs("div",{className:"text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"w-5 h-5 mr-2 text-[#0F8A69]"}),new Date(t.preferredDateTime).toLocaleString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-5 h-5 mr-2 text-[#0F8A69]"}),t.location||"No location yet"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Purpose:"})," ",t.purpose]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",e.jsx("span",{className:`font-bold ${t.status==="waiting for approval"?"text-yellow-600":t.status==="approved"?"text-blue-600":t.status==="rejected"?"text-red-600":"text-green-600"}`,children:t.status})]})]}),e.jsx("button",{className:`mt-4 px-4 py-2 rounded-lg text-white ${t.status==="waiting for approval"?"bg-[#0F8A69] hover:bg-[#0c7356]":t.status==="approved"?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-default"}`,onClick:()=>{t.status==="waiting for approval"||t.status,w(t)},children:t.status==="waiting for approval"?"Respond":t.status==="approved"?"Update":"View"})]},t.id))}),F&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-xl w-96",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:s.status==="waiting for approval"||s.status==="approved"?"Respond to Appointment":"View Appointment"}),(s.status==="waiting for approval"||s.status==="approved")&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Action"}),e.jsxs("select",{className:"border p-2 rounded-lg w-full mb-4",value:a,onChange:t=>{const n=t.target.value;h(n),n==="approve"&&c(""),(n==="reject"||n==="fail")&&d("")},children:[e.jsx("option",{value:"",children:"Choose Action"}),s.status==="waiting for approval"&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"approve",children:"Approve"}),e.jsx("option",{value:"reject",children:"Reject"})]}),s.status==="approved"&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"complete",children:"Mark as Completed"}),e.jsx("option",{value:"fail",children:"Mark as Failed"})]})]}),a==="approve"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Location"}),e.jsx("input",{className:"border p-2 rounded-lg w-full mb-4",placeholder:"Enter location",value:x,onChange:t=>d(t.target.value)})]}),(a==="reject"||a==="fail")&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Reason"}),e.jsx("textarea",{className:"border p-2 rounded-lg w-full mb-4",rows:3,placeholder:"Provide a reason",value:i,onChange:t=>c(t.target.value)})]}),a&&e.jsx("button",{className:`w-full py-2 rounded-lg text-white ${a==="approve"||a==="complete"?"bg-[#0F8A69] hover:bg-[#0c7356]":"bg-red-600 hover:bg-red-700"}`,onClick:()=>p(!0),disabled:r,children:r?"Processing...":"Proceed"})]}),s.status==="rejected"||s.status==="completed"?e.jsx("p",{children:"No further actions available."}):null,e.jsx("button",{className:"mt-4 w-full bg-gray-300 py-2 rounded-lg",onClick:N,disabled:r,children:"Close"})]})}),R&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-80",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Confirm Action"}),e.jsxs("p",{className:"mb-6 text-gray-700",children:["Are you sure you want to"," ",e.jsx("span",{className:"font-bold",children:a})," this appointment?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition",disabled:r,children:"Cancel"}),e.jsx("button",{onClick:k,className:"px-4 py-2 rounded-lg bg-[#0F8A69] text-white hover:bg-[#0c7356] transition",disabled:r,children:r?"Processing...":"Confirm"})]})]})})]})}export{U as default};
